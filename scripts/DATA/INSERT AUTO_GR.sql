--Insert to auto_gr with flag 'GR'
insert INTO AUTO_GR ( CREATED_DATE,IS_POSTED,LINE_ITEM,PO_DATE,PO_NUMBER,QTY_ITEM)
SELECT '2018-02-04 15:00:00' AS CREATED_DATE,0 AS IS_POSTED, F30 AS LINE_ITEM,'2018-02-04' AS PO_DATE,F29 AS PO_NUMBER, 1 AS QTY_ITEM
FROM OPENROWSET(
    'Microsoft.ACE.OLEDB.12.0',
    'Excel 8.0;HDR=NO;Database=D:\FILE.xls',
    'select * from [sheet1$]')
WHERE F1 <> 'Police Number' AND F52 = 'GR' and  NOT EXISTS (SELECT * FROM AUTO_GR cr
WHERE  '2018-02-04 15:00:00' = cr.CREATED_DATE )
and F30 IS NOT NULL

--Insert to auto_gr with flag 'NO'
insert INTO AUTO_GR ( CREATED_DATE,IS_POSTED,LINE_ITEM,PO_DATE,PO_NUMBER,QTY_ITEM)
SELECT '2018-02-04 15:00:00' AS CREATED_DATE,1 AS IS_POSTED, F30 AS LINE_ITEM,'2018-02-04' AS PO_DATE,F29 AS PO_NUMBER, 1 AS QTY_ITEM
FROM OPENROWSET(
    'Microsoft.ACE.OLEDB.12.0',
    'Excel 8.0;HDR=NO;Database=D:\FILE.xls',
    'select * from [sheet1$]')
WHERE F1 <> 'Police Number' AND F52 = 'no' and  NOT EXISTS (SELECT * FROM AUTO_GR cr
WHERE  F29 = cr.PO_NUMBER AND cr.LINE_ITEM = F30 AND  MONTH(cr.PO_DATE) = 2 AND YEAR(cr.PO_DATE) =2018 AND cr.CREATED_DATE = '2018-02-04 15:00:00')
and F30 IS NOT NULL



