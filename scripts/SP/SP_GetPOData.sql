Create procedure [dbo].[GetPOData]
AS BEGIN

	MERGE PO_REPORT_DATA AS Target
	USING (
		select POLICE_NUMBER, SUPPLY_METHOD, EMPLOYEE_NAME, COST_CENTER, MANUFACTURER, MODEL, SERIES, 
		BODY_TYPE, COLOR, CHASIS_NUMBER, ENGINE_NUMBER, VEHICLE_TYPE, VEHICLE_USAGE, START_CONTRACT, 
		END_CONTRACT, VENDOR_NAME, MONTHLY_HMS_INSTALLMENT, 
		IIF (((VAT_DECIMAL is null)OR(VAT_DECIMAL <> 0)), MONTHLY_HMS_INSTALLMENT * 0.1, 0) AS GST, 
		(IIF (((VAT_DECIMAL is null)OR(VAT_DECIMAL <> 0)), MONTHLY_HMS_INSTALLMENT * 0.1, 0) + MONTHLY_HMS_INSTALLMENT) AS TOTAL_MONTHLY_INSTALLMENT, 
		PO_NUMBER, PO_LINE, CREATED_DATE, MST_FLEET_ID
		FROM MST_FLEET
	) AS Source
	On (Source.CHASIS_NUMBER = Target.CHASIS_NUMBER)
	AND (Source.CREATED_DATE = Target.CREATED_DATE)
	WHEN NOT MATCHED BY TARGET THEN
		INSERT (POLICE_NUMBER, SUPPLY_METHOD, EMPLOYEE_NAME, COST_CENTER, MANUFACTURER, MODEL, SERIES, BODY_TYPE, 
		COLOR, CHASIS_NUMBER, ENGINE_NUMBER, VEHICLE_TYPE, VEHICLE_USAGE, START_CONTRACT, END_CONTRACT, VENDOR, 
		MONTHLY_INSTALLMENT, GST, TOTAL_MONTHLY_INSTALLMENT, PO_NUMBER, PO_LINE, REPORT_MONTH, REPORT_YEAR, CREATED_DATE)
		VALUES( Source.POLICE_NUMBER, Source.SUPPLY_METHOD, Source.EMPLOYEE_NAME, Source.COST_CENTER, Source.MANUFACTURER, 
		Source.MODEL, Source.SERIES, Source.BODY_TYPE, Source.COLOR, Source.CHASIS_NUMBER, Source.ENGINE_NUMBER,
		Source.VEHICLE_TYPE, Source.VEHICLE_USAGE, Source.START_CONTRACT, Source.END_CONTRACT, Source.VENDOR_NAME, Source.MONTHLY_HMS_INSTALLMENT, 
		Source.GST, Source.TOTAL_MONTHLY_INSTALLMENT, Source.PO_NUMBER, Source.PO_LINE, MONTH(Source.CREATED_DATE), YEAR(Source.CREATED_DATE), Source.CREATED_DATE);

END